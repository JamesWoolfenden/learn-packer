<!doctype html><html lang=en class=no-js> <head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1"><meta name=author content="James Woolfenden"><link rel="shortcut icon" href=../assets/images/favicon.ico><meta name=generator content="mkdocs-1.1.2, mkdocs-material-6.2.8"><title>docker - Learn Packer</title><link rel=stylesheet href=../assets/stylesheets/main.cb6bc1d0.min.css><link rel=stylesheet href=../assets/stylesheets/palette.39b8e14a.min.css><link rel=preconnect href=https://fonts.gstatic.com crossorigin><link rel=stylesheet href="https://fonts.googleapis.com/css?family=Roboto:300,400,400i,700%7CRoboto+Mono&display=fallback"><style>body,input{font-family:"Roboto",-apple-system,BlinkMacSystemFont,Helvetica,Arial,sans-serif}code,kbd,pre{font-family:"Roboto Mono",SFMono-Regular,Consolas,Menlo,monospace}</style><link rel=manifest href=../manifest.webmanifest crossorigin=use-credentials><script>window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)},ga.l=+new Date,ga("create","UA-151885688-2","jameswoolfenden.github.io/learn-packer/"),ga("set","anonymizeIp",!0),ga("send","pageview"),document.addEventListener("DOMContentLoaded",function(){document.forms.search&&document.forms.search.query.addEventListener("blur",function(){if(this.value){var e=document.location.pathname;ga("send","pageview",e+"?q="+this.value)}})}),document.addEventListener("DOMContentSwitch",function(){ga("send","pageview",document.location.pathname)})</script><script async src=https://www.google-analytics.com/analytics.js></script></head> <body dir=ltr data-md-color-scheme data-md-color-primary=none data-md-color-accent=none> <input class=md-toggle data-md-toggle=drawer type=checkbox id=__drawer autocomplete=off> <input class=md-toggle data-md-toggle=search type=checkbox id=__search autocomplete=off> <label class=md-overlay for=__drawer></label> <div data-md-component=skip> <a href=#packer-docker class=md-skip> Skip to content </a> </div> <div data-md-component=announce> </div> <header class=md-header data-md-component=header> <nav class="md-header-nav md-grid" aria-label=Header> <a href=.. title="Learn Packer" class="md-header-nav__button md-logo" aria-label="Learn Packer"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> <label class="md-header-nav__button md-icon" for=__drawer> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2z"/></svg> </label> <div class=md-header-nav__title data-md-component=header-title> <div class=md-header-nav__ellipsis> <div class=md-header-nav__topic> <span class=md-ellipsis> Learn Packer </span> </div> <div class=md-header-nav__topic> <span class=md-ellipsis> docker </span> </div> </div> </div> <label class="md-header-nav__button md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> </label> <div class=md-search data-md-component=search role=dialog> <label class=md-search__overlay for=__search></label> <div class=md-search__inner role=search> <form class=md-search__form name=search> <input type=text class=md-search__input name=query aria-label=Search placeholder=Search autocapitalize=off autocorrect=off autocomplete=off spellcheck=false data-md-component=search-query data-md-state=active required> <label class="md-search__icon md-icon" for=__search> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0116 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 019.5 16 6.5 6.5 0 013 9.5 6.5 6.5 0 019.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5z"/></svg> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </label> <button type=reset class="md-search__icon md-icon" aria-label=Clear data-md-component=search-reset tabindex=-1> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41z"/></svg> </button> </form> <div class=md-search__output> <div class=md-search__scrollwrap data-md-scrollfix> <div class=md-search-result data-md-component=search-result> <div class=md-search-result__meta> Initializing search </div> <ol class=md-search-result__list></ol> </div> </div> </div> </div> </div> <div class=md-header-nav__source> <a href=https://github.com/jamesWoolfenden/learn-packer/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> jamesWoolfenden/learn-packer </div> </a> </div> </nav> </header> <div class=md-container data-md-component=container> <nav class=md-tabs aria-label=Tabs data-md-component=tabs> <div class="md-tabs__inner md-grid"> <ul class=md-tabs__list> <li class=md-tabs__item> <a href=.. class=md-tabs__link> Home </a> </li> <li class=md-tabs__item> <a href=../installing-packer/ class=md-tabs__link> Installing </a> </li> <li class=md-tabs__item> <a href=../packer-aws-ami/ class=md-tabs__link> AWS AMI </a> </li> <li class=md-tabs__item> <a href=../packer-aws-ami.2/ class=md-tabs__link> Advanced AWS authentication </a> </li> <li class=md-tabs__item> <a href=../packer-aws-ami.3/ class=md-tabs__link> Versioning </a> </li> <li class=md-tabs__item> <a href=./ class="md-tabs__link md-tabs__link--active"> Docker </a> </li> <li class=md-tabs__item> <a href=../ansible-docker/ class=md-tabs__link> Ansible-Docker </a> </li> <li class=md-tabs__item> <a href=../packer-file/ class=md-tabs__link> File </a> </li> <li class=md-tabs__item> <a href=../packer-iso/ class=md-tabs__link> ISO </a> </li> <li class=md-tabs__item> <a href=../packer-null/ class=md-tabs__link> Null builders </a> </li> <li class=md-tabs__item> <a href=../post-processor/ class=md-tabs__link> Post-processor </a> </li> <li class=md-tabs__item> <a href=../variables/ class=md-tabs__link> Variables </a> </li> <li class=md-tabs__item> <a href=../extending/ class=md-tabs__link> Extending </a> </li> <li class=md-tabs__item> <a href=../imagebuilder/ class=md-tabs__link> Imagebuilder </a> </li> <li class=md-tabs__item> <a href=../functions/ class=md-tabs__link> Functions </a> </li> <li class=md-tabs__item> <a href=../hcl2/ class=md-tabs__link> HCL2 </a> </li> <li class=md-tabs__item> <a href=../share/ class=md-tabs__link> Sharing </a> </li> <li class=md-tabs__item> <a href=../help/ class=md-tabs__link> Help </a> </li> <li class=md-tabs__item> <a href=../about/ class=md-tabs__link> About </a> </li> </ul> </div> </nav> <main class=md-main data-md-component=main> <div class="md-main__inner md-grid"> <div class="md-sidebar md-sidebar--primary" data-md-component=navigation> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--primary md-nav--lifted" aria-label=Navigation data-md-level=0> <label class=md-nav__title for=__drawer> <a href=.. title="Learn Packer" class="md-nav__button md-logo" aria-label="Learn Packer"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M12 8a3 3 0 003-3 3 3 0 00-3-3 3 3 0 00-3 3 3 3 0 003 3m0 3.54C9.64 9.35 6.5 8 3 8v11c3.5 0 6.64 1.35 9 3.54 2.36-2.19 5.5-3.54 9-3.54V8c-3.5 0-6.64 1.35-9 3.54z"/></svg> </a> Learn Packer </label> <div class=md-nav__source> <a href=https://github.com/jamesWoolfenden/learn-packer/ title="Go to repository" class=md-source> <div class="md-source__icon md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M439.55 236.05L244 40.45a28.87 28.87 0 00-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 01-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 000 40.81l195.61 195.6a28.86 28.86 0 0040.8 0l194.69-194.69a28.86 28.86 0 000-40.81z"/></svg> </div> <div class=md-source__repository> jamesWoolfenden/learn-packer </div> </a> </div> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=.. class=md-nav__link> Home </a> </li> <li class=md-nav__item> <a href=../installing-packer/ class=md-nav__link> Installing </a> </li> <li class=md-nav__item> <a href=../packer-aws-ami/ class=md-nav__link> AWS AMI </a> </li> <li class=md-nav__item> <a href=../packer-aws-ami.2/ class=md-nav__link> Advanced AWS authentication </a> </li> <li class=md-nav__item> <a href=../packer-aws-ami.3/ class=md-nav__link> Versioning </a> </li> <li class="md-nav__item md-nav__item--active md-nav__item--nested"> <input class="md-nav__toggle md-toggle" data-md-toggle=nav-6 type=checkbox id=nav-6 checked> <label class=md-nav__link for=nav-6> Docker <span class="md-nav__icon md-icon"></span> </label> <nav class=md-nav aria-label=Docker data-md-level=1> <label class=md-nav__title for=nav-6> <span class="md-nav__icon md-icon"></span> Docker </label> <ul class=md-nav__list data-md-scrollfix> <li class="md-nav__item md-nav__item--active"> <input class="md-nav__toggle md-toggle" data-md-toggle=toc type=checkbox id=__toc> <label class="md-nav__link md-nav__link--active" for=__toc> docker <span class="md-nav__icon md-icon"></span> </label> <a href=./ class="md-nav__link md-nav__link--active"> docker </a> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#a-very-basic-packer-docker-template class=md-nav__link> A very basic Packer Docker template </a> </li> <li class=md-nav__item> <a href=#tagging-with-a-post-processor class=md-nav__link> Tagging with a post-processor </a> </li> <li class=md-nav__item> <a href=#building-into-an-aws-registry class=md-nav__link> Building into an AWS registry </a> </li> <li class=md-nav__item> <a href=#provisioners class=md-nav__link> Provisioners </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../docker-hcl2/ class=md-nav__link> docker-hcl </a> </li> </ul> </nav> </li> <li class=md-nav__item> <a href=../ansible-docker/ class=md-nav__link> Ansible-Docker </a> </li> <li class=md-nav__item> <a href=../packer-file/ class=md-nav__link> File </a> </li> <li class=md-nav__item> <a href=../packer-iso/ class=md-nav__link> ISO </a> </li> <li class=md-nav__item> <a href=../packer-null/ class=md-nav__link> Null builders </a> </li> <li class=md-nav__item> <a href=../post-processor/ class=md-nav__link> Post-processor </a> </li> <li class=md-nav__item> <a href=../variables/ class=md-nav__link> Variables </a> </li> <li class=md-nav__item> <a href=../extending/ class=md-nav__link> Extending </a> </li> <li class=md-nav__item> <a href=../imagebuilder/ class=md-nav__link> Imagebuilder </a> </li> <li class=md-nav__item> <a href=../functions/ class=md-nav__link> Functions </a> </li> <li class=md-nav__item> <a href=../hcl2/ class=md-nav__link> HCL2 </a> </li> <li class=md-nav__item> <a href=../share/ class=md-nav__link> Sharing </a> </li> <li class=md-nav__item> <a href=../help/ class=md-nav__link> Help </a> </li> <li class=md-nav__item> <a href=../about/ class=md-nav__link> About </a> </li> </ul> </nav> </div> </div> </div> <div class="md-sidebar md-sidebar--secondary" data-md-component=toc> <div class=md-sidebar__scrollwrap> <div class=md-sidebar__inner> <nav class="md-nav md-nav--secondary" aria-label="Table of contents"> <label class=md-nav__title for=__toc> <span class="md-nav__icon md-icon"></span> Table of contents </label> <ul class=md-nav__list data-md-scrollfix> <li class=md-nav__item> <a href=#a-very-basic-packer-docker-template class=md-nav__link> A very basic Packer Docker template </a> </li> <li class=md-nav__item> <a href=#tagging-with-a-post-processor class=md-nav__link> Tagging with a post-processor </a> </li> <li class=md-nav__item> <a href=#building-into-an-aws-registry class=md-nav__link> Building into an AWS registry </a> </li> <li class=md-nav__item> <a href=#provisioners class=md-nav__link> Provisioners </a> </li> </ul> </nav> </div> </div> </div> <div class=md-content> <article class="md-content__inner md-typeset"> <a href=https://github.com/jamesWoolfenden/learn-packer/edit/master/docs/docker.md title="Edit this page" class="md-content__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20.71 7.04c.39-.39.39-1.04 0-1.41l-2.34-2.34c-.37-.39-1.02-.39-1.41 0l-1.84 1.83 3.75 3.75M3 17.25V21h3.75L17.81 9.93l-3.75-3.75L3 17.25z"/></svg> </a> <h1 id=packer-docker>Packer-Docker</h1> <p>Using Packer to build Docker might seem a bit strange at first. Aren't Dockerfiles a standard for building Docker containers? I'd be thinking this'll never fly with my JS developers? But It can make sense.</p> <p>To build with a Dockerfile, and to save to it to a registry requires 2 steps, first to build with a CI tool like Gitlab/Circle and requires a Dockerfile and a process to manage logging into the registry and pushing to it.</p> <p>In Packer this entire process can be captured in one file, encapsulating all that's required, and as a bonus the whole process is runnable locally. Which make for quick debug cycle times.</p> <p>Using Packer also allows the use and re-use of scripts and to use Ansible role and playbooks as used in other platform builds.</p> <h2 id=a-very-basic-packer-docker-template>A very basic Packer Docker template</h2> <p>Starting really simple with <strong>packer-docker-ubuntu.json</strong>.</p> <div class=highlight><pre><span></span><code><span class=p>{</span>
  <span class=nt>&quot;_comment&quot;</span><span class=p>:</span> <span class=s2>&quot;Docker&quot;</span><span class=p>,</span>
  <span class=nt>&quot;builders&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker&quot;</span><span class=p>,</span>
      <span class=nt>&quot;image&quot;</span><span class=p>:</span> <span class=s2>&quot;ubuntu&quot;</span><span class=p>,</span>
      <span class=nt>&quot;export_path&quot;</span><span class=p>:</span> <span class=s2>&quot;image.tar&quot;</span>
    <span class=p>}</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>Building this template with..</p> <div class=highlight><pre><span></span><code>$ packer build packer-docker-ubuntu.json
docker output will be in this color.

==&gt; docker: Creating a temporary directory for sharing data...
==&gt; docker: Pulling Docker image: ubuntu
    docker: Using default tag: latest
    docker: latest: Pulling from library/ubuntu
    docker: 898c46f3b1a1: Pulling fs layer
    docker: 63366dfa0a50: Pulling fs layer
    docker: 041d4cd74a92: Pulling fs layer
    docker: 6e1bee0f8701: Pulling fs layer
    docker: 6e1bee0f8701: Waiting
    docker: 041d4cd74a92: Verifying Checksum
    docker: 041d4cd74a92: Download complete
    docker: 63366dfa0a50: Verifying Checksum
    docker: 63366dfa0a50: Download complete
    docker: 6e1bee0f8701: Download complete
    docker: 898c46f3b1a1: Verifying Checksum
    docker: 898c46f3b1a1: Download complete
    docker: 898c46f3b1a1: Pull complete
    docker: 63366dfa0a50: Pull complete
    docker: 041d4cd74a92: Pull complete
    docker: 6e1bee0f8701: Pull complete
    docker: Digest: sha256:017eef0b616011647b269b5c65826e2e2ebddbe5d1f8c1e56b3599fb14fabec8
    docker: Status: Downloaded newer image for ubuntu:latest
==&gt; docker: Starting docker container...
    docker: Run command: docker run -v /home/jim/.packer.d/tmp:/packer-files -d -i -t ubuntu /bin/bash
    docker: Container ID: 2dc59e83c81eef5feb0bfa5370a1616bdae5effa93b01ca6378716815582425d
==&gt; docker: Using docker communicator to connect: 172.17.0.2
==&gt; docker: Exporting the container
==&gt; docker: Killing the container: 2dc59e83c81eef5feb0bfa5370a1616bdae5effa93b01ca6378716815582425d
Build &#39;docker&#39; finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; docker: Exported Docker file: image.tar
</code></pre></div> <p>OK so that's Not that useful yet. Yet.</p> <h2 id=tagging-with-a-post-processor>Tagging with a post-processor</h2> <p>So far you have seen demonstrated that a build of a container with Packer, but it's not good for much yet. Next is to start plugging in other components.</p> <p>First up is a post-processor, used to tag the container. Enter the example <strong>packer-docker-tag-empty.json</strong></p> <div class=highlight><pre><span></span><code><span class=p>{</span>
  <span class=nt>&quot;variables&quot;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&quot;tag&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `BUILD_NUMBER`}}&quot;</span>
  <span class=p>},</span>
  <span class=nt>&quot;builders&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker&quot;</span><span class=p>,</span>
      <span class=nt>&quot;image&quot;</span><span class=p>:</span> <span class=s2>&quot;ubuntu&quot;</span><span class=p>,</span>
      <span class=nt>&quot;commit&quot;</span><span class=p>:</span> <span class=kc>true</span>
    <span class=p>}</span>
  <span class=p>],</span>
  <span class=nt>&quot;post-processors&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker-tag&quot;</span><span class=p>,</span>
      <span class=nt>&quot;tag&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `tag`}}&quot;</span>
    <span class=p>}</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>Still not exactly Rocket Science yet, is it.</p> <p>Trying it out.</p> <div class=highlight><pre><span></span><code>$ packer build -var tag=2 packer-docker-tag-empty.json
docker output will be in this color.

==&gt; docker: Creating a temporary directory for sharing data...
==&gt; docker: Pulling Docker image: ubuntu
    docker: Using default tag: latest
    docker: latest: Pulling from library/ubuntu
    docker: Digest: sha256:017eef0b616011647b269b5c65826e2e2ebddbe5d1f8c1e56b3599fb14fabec8
    docker: Status: Image is up to date for ubuntu:latest
==&gt; docker: Starting docker container...
    docker: Run command: docker run -v /home/jim/.packer.d/tmp:/packer-files -d -i -t ubuntu /bin/bash
    docker: Container ID: fe20e550df8e38e99a4a87ffe1836c646eecce7cf31db5da67f55d80c6ba54f8
==&gt; docker: Using docker communicator to connect: 172.17.0.2
==&gt; docker: Committing the container
    docker: Image ID: sha256:bd89cee10dc09fd28dd5cf1d00fc62fd659db014ef96b2d62a74eccf88c4b70d
==&gt; docker: Killing the container: fe20e550df8e38e99a4a87ffe1836c646eecce7cf31db5da67f55d80c6ba54f8
==&gt; docker: Running post-processor: docker-tag
    docker (docker-tag): Tagging image: sha256:bd89cee10dc09fd28dd5cf1d00fc62fd659db014ef96b2d62a74eccf88c4b70d
    docker (docker-tag): Repository: dave:2
Build &#39;docker&#39; finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; docker: Imported Docker image: sha256:bd89cee10dc09fd28dd5cf1d00fc62fd659db014ef96b2d62a74eccf88c4b70d
--&gt; docker: Imported Docker image: dave:2
</code></pre></div> <p>So now we have a tagged Dave:2 container. Contain your excitement. Ok let's move on.</p> <h2 id=building-into-an-aws-registry>Building into an AWS registry</h2> <p>This next example will do everything, ok the main stuff for a container, build, tag and push to ECR. Running packer build <strong>.\packer-docker-aws-ecr.json</strong></p> <div class=highlight><pre><span></span><code><span class=p>{</span>
  <span class=nt>&quot;_comment&quot;</span><span class=p>:</span> <span class=s2>&quot;Docker AWS ECR&quot;</span><span class=p>,</span>
  <span class=nt>&quot;variables&quot;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&quot;tag&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `BUILD_NUMBER`}}&quot;</span><span class=p>,</span>
    <span class=nt>&quot;repository&quot;</span><span class=p>:</span> <span class=s2>&quot;123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container&quot;</span><span class=p>,</span>
    <span class=nt>&quot;aws_access_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `AWS_ACCESS_KEY_ID`}}&quot;</span><span class=p>,</span>
    <span class=nt>&quot;aws_secret_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `AWS_SECRET_ACCESS_KEY`}}&quot;</span><span class=p>,</span>
    <span class=nt>&quot;login_server&quot;</span><span class=p>:</span> <span class=s2>&quot;https://123456789012.dkr.ecr.eu-west-1.amazonaws.com/&quot;</span>
  <span class=p>},</span>
  <span class=nt>&quot;_comment&quot;</span><span class=p>:</span> <span class=s2>&quot;SSH needs to be on container for shell provisioner&quot;</span><span class=p>,</span>
  <span class=nt>&quot;builders&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker&quot;</span><span class=p>,</span>
      <span class=nt>&quot;image&quot;</span><span class=p>:</span> <span class=s2>&quot;hashicorp/terraform&quot;</span><span class=p>,</span>
      <span class=nt>&quot;commit&quot;</span><span class=p>:</span> <span class=kc>true</span>
    <span class=p>}</span>
  <span class=p>],</span>
  <span class=nt>&quot;post-processors&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>[</span>
      <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker-tag&quot;</span><span class=p>,</span>
        <span class=nt>&quot;tag&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `tag`}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;repository&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `repository`}}&quot;</span>
      <span class=p>},</span>
      <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker-push&quot;</span><span class=p>,</span>
        <span class=nt>&quot;ecr_login&quot;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
        <span class=nt>&quot;aws_access_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `aws_access_key`}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;aws_secret_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `aws_secret_key`}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;login_server&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `login_server`}}&quot;</span>
      <span class=p>}</span>
    <span class=p>]</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>When this runs in Packer...</p> <div class=highlight><pre><span></span><code>docker output will be in this color.

==&gt; docker: Creating a temporary directory for sharing data...
==&gt; docker: Pulling Docker image: hashicorp/terraform
    docker: Using default tag: latest
    docker: latest: Pulling from hashicorp/terraform
    docker: Digest: sha256:330bef7401e02e757e6fa2de69f398fd29fcbfafe2a3b9e8f150486fbcd7915b
    docker: Status: Image is up to date for hashicorp/terraform:latest
==&gt; docker: Starting docker container...
    docker: Run command: docker run -v /c/Users/james.woolfenden/packer.d/tmp:/packer-files -d -i -t hashicorp/terraform /bin/bash
    docker: Container ID: fa8f17d078f1978cda0a7b0c9352e7afffc8a2cb57db425faff3cc8f9816cf5d
==&gt; docker: Using docker communicator to connect:
==&gt; docker: Committing the container
    docker: Image ID: sha256:759f4b14fe9d477a7a6492ff9c1becd77e3d8b1e01a89f07275c8d72f3e7907d
==&gt; docker: Killing the container: fa8f17d078f1978cda0a7b0c9352e7afffc8a2cb57db425faff3cc8f9816cf5d
==&gt; docker: Running post-processor: docker-tag
    docker (docker-tag): Tagging image: sha256:759f4b14fe9d477a7a6492ff9c1becd77e3d8b1e01a89f07275c8d72f3e7907d
    docker (docker-tag): Repository: 123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5
==&gt; docker: Running post-processor: docker-push
    docker (docker-push): Fetching ECR credentials...
    docker (docker-push): Logging in...
    docker (docker-push): Login Succeeded
    docker (docker-push): Pushing: 123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5
    docker (docker-push): The push refers to repository [123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container]
    docker (docker-push): 6ad0db50b392: Preparing
    docker (docker-push): 1eeb4487de94: Preparing
    docker (docker-push): 9094b98cdb25: Preparing
    docker (docker-push): 503e53e365f3: Preparing
    docker (docker-push): 9094b98cdb25: Layer already exists
    docker (docker-push): 1eeb4487de94: Layer already exists
    docker (docker-push): 503e53e365f3: Layer already exists
    docker (docker-push): 6ad0db50b392: Pushed
    docker (docker-push): 5: digest: sha256:82de02fbaab0a2c35d033cae5278c59e1d8e65ee2bb4cb5a57b803536b305a3c size: 1155
    docker (docker-push): Logging out...
    docker (docker-push): Removing login credentials for 123456789012.dkr.ecr.eu-west-1.amazonaws.com
Build &#39;docker&#39; finished.

==&gt; Builds finished. The artifacts of successful builds are:
--&gt; docker: Imported Docker image: sha256:759f4b14fe9d477a7a6492ff9c1becd77e3d8b1e01a89f07275c8d72f3e7907d
--&gt; docker: Imported Docker image: 123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5
--&gt; docker: Imported Docker image: 123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5
</code></pre></div> <p>While that's great, we added nothing to the container so it doesn't prove that much yet. Sure it connected to ECR and pushed the container, but we added nothing to it, for that, we need to add some Provisioners.</p> <p>Packer builds containers will only work with Docker images that already have SSH on them. Reading this will save you a lot of time. I've changed the base image from <strong>hashicorp/terraform</strong> to <strong>ebiwd/alpine-ssh</strong>, and added terraform to its package list.</p> <p>This the shell script it runs on the Provisioner <strong>install_awscli.sh</strong>.</p> <div class=highlight><pre><span></span><code><span class=ch>#!/bin/sh</span>
apk update
apk add --update nodejs-current nodejs-npm terraform
apk add --update python python-dev py-pip build-base
pip install --upgrade pip
pip install awscli
</code></pre></div> <h2 id=provisioners>Provisioners</h2> <p>This next example combines the lot, it's imaginatively called <strong>packer-docker-aws-ecr-shell.json</strong></p> <div class=highlight><pre><span></span><code><span class=p>{</span>
  <span class=nt>&quot;_comment&quot;</span><span class=p>:</span> <span class=s2>&quot;Docker AWS ECR&quot;</span><span class=p>,</span>
  <span class=nt>&quot;variables&quot;</span><span class=p>:</span> <span class=p>{</span>
    <span class=nt>&quot;tag&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `BUILD_NUMBER`}}&quot;</span><span class=p>,</span>
    <span class=nt>&quot;repository&quot;</span><span class=p>:</span> <span class=s2>&quot;123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container&quot;</span><span class=p>,</span>
    <span class=nt>&quot;aws_access_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `AWS_ACCESS_KEY_ID`}}&quot;</span><span class=p>,</span>
    <span class=nt>&quot;aws_secret_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{env `AWS_SECRET_ACCESS_KEY`}}&quot;</span><span class=p>,</span>
    <span class=nt>&quot;login_server&quot;</span><span class=p>:</span> <span class=s2>&quot;https://123456789012.dkr.ecr.eu-west-1.amazonaws.com/&quot;</span>
  <span class=p>},</span>
  <span class=nt>&quot;_comment&quot;</span><span class=p>:</span> <span class=s2>&quot;SSH needs to be on container for shell provisioner&quot;</span><span class=p>,</span>
  <span class=nt>&quot;builders&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker&quot;</span><span class=p>,</span>
      <span class=nt>&quot;image&quot;</span><span class=p>:</span> <span class=s2>&quot;ebiwd/alpine-ssh&quot;</span><span class=p>,</span>
      <span class=nt>&quot;commit&quot;</span><span class=p>:</span> <span class=kc>true</span>
    <span class=p>}</span>
  <span class=p>],</span>
  <span class=nt>&quot;_comment&quot;</span><span class=p>:</span> <span class=s2>&quot;probs bash needs to be there&quot;</span><span class=p>,</span>
  <span class=nt>&quot;provisioners&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;shell&quot;</span><span class=p>,</span>
      <span class=nt>&quot;inline&quot;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&quot;apk add bash&quot;</span><span class=p>]</span>
    <span class=p>},</span>
    <span class=p>{</span>
      <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;shell&quot;</span><span class=p>,</span>
      <span class=nt>&quot;script&quot;</span><span class=p>:</span> <span class=s2>&quot;install-awscli.sh&quot;</span>
    <span class=p>}</span>
  <span class=p>],</span>
  <span class=nt>&quot;post-processors&quot;</span><span class=p>:</span> <span class=p>[</span>
    <span class=p>[</span>
      <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker-tag&quot;</span><span class=p>,</span>
        <span class=nt>&quot;tag&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `tag`}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;repository&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `repository`}}&quot;</span>
      <span class=p>},</span>
      <span class=p>{</span>
        <span class=nt>&quot;type&quot;</span><span class=p>:</span> <span class=s2>&quot;docker-push&quot;</span><span class=p>,</span>
        <span class=nt>&quot;ecr_login&quot;</span><span class=p>:</span> <span class=kc>true</span><span class=p>,</span>
        <span class=nt>&quot;aws_access_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `aws_access_key`}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;aws_secret_key&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `aws_secret_key`}}&quot;</span><span class=p>,</span>
        <span class=nt>&quot;login_server&quot;</span><span class=p>:</span> <span class=s2>&quot;{{user `login_server`}}&quot;</span>
      <span class=p>}</span>
    <span class=p>]</span>
  <span class=p>]</span>
<span class=p>}</span>
</code></pre></div> <p>Let's built it:</p> <div class=highlight><pre><span></span><code>$ packer build .<span class=se>\p</span>acker-docker-aws-ecr.json
docker output will be <span class=k>in</span> this color.

<span class=o>==</span>&gt; docker: Creating a temporary directory <span class=k>for</span> sharing data...
<span class=o>==</span>&gt; docker: Pulling Docker image: ebiwd/alpine-ssh
    docker: Using default tag: latest
    docker: latest: Pulling from ebiwd/alpine-ssh
    docker: 59265c40e257: Pulling fs layer
    docker: a621cd180b0b: Pulling fs layer
    docker: 1388eaedce13: Pulling fs layer
    docker: 75cc2d2e3f13: Pulling fs layer
    docker: b4ac607039c6: Pulling fs layer
    docker: 75cc2d2e3f13: Waiting
    docker: b4ac607039c6: Waiting
    docker: 59265c40e257: Verifying Checksum
    docker: 59265c40e257: Download <span class=nb>complete</span>
    docker: 59265c40e257: Pull <span class=nb>complete</span>
    docker: 75cc2d2e3f13: Verifying Checksum
    docker: 75cc2d2e3f13: Download <span class=nb>complete</span>
    docker: b4ac607039c6: Download <span class=nb>complete</span>
    docker: a621cd180b0b: Verifying Checksum
    docker: a621cd180b0b: Download <span class=nb>complete</span>
    docker: a621cd180b0b: Pull <span class=nb>complete</span>
    docker: 1388eaedce13: Verifying Checksum
    docker: 1388eaedce13: Download <span class=nb>complete</span>
    docker: 1388eaedce13: Pull <span class=nb>complete</span>
    docker: 75cc2d2e3f13: Pull <span class=nb>complete</span>
    docker: b4ac607039c6: Pull <span class=nb>complete</span>
    docker: Digest: sha256:6d994480f495fc7ddc16d126e4c41f9fc0153363b6f9e686f50d47039078615c
    docker: Status: Downloaded newer image <span class=k>for</span> ebiwd/alpine-ssh:latest
<span class=o>==</span>&gt; docker: Starting docker container...
    docker: Run command: docker run -v /c/Users/SOMEUSER/packer.d/tmp:/packer-files -d -i -t ebiwd/alpine-ssh /bin/bash
    docker: Container ID: <span class=nv>5fbda610d9117b5a2c20f5da6e77b4cb230114c44fbf79b168a30e32e3bc26f2</span>
<span class=o>==</span>&gt; docker: Using docker communicator to connect: <span class=m>172</span>.17.0.2
<span class=o>==</span>&gt; docker: Provisioning with shell script: C:<span class=se>\U</span>sers<span class=se>\S</span>OMEUSER<span class=se>\A</span>ppData<span class=se>\L</span>ocal<span class=se>\T</span>emp<span class=se>\p</span>acker-shell350255759
    docker: OK: <span class=m>68</span> MiB <span class=k>in</span> <span class=m>39</span> packages
    docker: WARNING: Ignoring APKINDEX.84815163.tar.gz: No such file or directory
    docker: WARNING: Ignoring APKINDEX.24d64ab1.tar.gz: No such file or <span class=nv>directory</span>
<span class=o>==</span>&gt; docker: Provisioning with shell script: install-awscli.sh
    docker: fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/main/x86_64/APKINDEX.tar.gz
    docker: fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/community/x86_64/APKINDEX.tar.gz
    docker: v3.6.5-5-geec223036a <span class=o>[</span>http://dl-cdn.alpinelinux.org/alpine/v3.6/main<span class=o>]</span>
    docker: v3.6.5-4-g1bf6e4dfc6 <span class=o>[</span>http://dl-cdn.alpinelinux.org/alpine/v3.6/community<span class=o>]</span>
    docker: OK: <span class=m>8449</span> distinct packages available
    docker: fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/main/x86_64/APKINDEX.tar.gz
    docker: fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/community/x86_64/APKINDEX.tar.gz
    docker: <span class=o>(</span><span class=m>1</span>/8<span class=o>)</span> Installing libcrypto1.0 <span class=o>(</span><span class=m>1</span>.0.2r-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>2</span>/8<span class=o>)</span> Installing libgcc <span class=o>(</span><span class=m>6</span>.3.0-r4<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>3</span>/8<span class=o>)</span> Installing http-parser <span class=o>(</span><span class=m>2</span>.7.1-r1<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>4</span>/8<span class=o>)</span> Installing libssl1.0 <span class=o>(</span><span class=m>1</span>.0.2r-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>5</span>/8<span class=o>)</span> Installing libstdc++ <span class=o>(</span><span class=m>6</span>.3.0-r4<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>6</span>/8<span class=o>)</span> Installing libuv <span class=o>(</span><span class=m>1</span>.11.0-r1<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>7</span>/8<span class=o>)</span> Installing nodejs-current <span class=o>(</span><span class=m>7</span>.10.1-r1<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>8</span>/8<span class=o>)</span> Installing nodejs-npm <span class=o>(</span><span class=m>6</span>.10.3-r2<span class=o>)</span>
    docker: Executing busybox-1.26.2-r11.trigger
    docker: OK: <span class=m>110</span> MiB <span class=k>in</span> <span class=m>47</span> packages
    docker: fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/main/x86_64/APKINDEX.tar.gz
    docker: fetch http://dl-cdn.alpinelinux.org/alpine/v3.6/community/x86_64/APKINDEX.tar.gz
    docker: <span class=o>(</span><span class=m>1</span>/19<span class=o>)</span> Upgrading musl <span class=o>(</span><span class=m>1</span>.1.16-r14 -&gt; <span class=m>1</span>.1.16-r15<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>2</span>/19<span class=o>)</span> Installing binutils-libs <span class=o>(</span><span class=m>2</span>.30-r1<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>3</span>/19<span class=o>)</span> Installing binutils <span class=o>(</span><span class=m>2</span>.30-r1<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>4</span>/19<span class=o>)</span> Installing gmp <span class=o>(</span><span class=m>6</span>.1.2-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>5</span>/19<span class=o>)</span> Installing isl <span class=o>(</span><span class=m>0</span>.17.1-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>6</span>/19<span class=o>)</span> Installing libgomp <span class=o>(</span><span class=m>6</span>.3.0-r4<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>7</span>/19<span class=o>)</span> Installing libatomic <span class=o>(</span><span class=m>6</span>.3.0-r4<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>8</span>/19<span class=o>)</span> Installing pkgconf <span class=o>(</span><span class=m>1</span>.3.7-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>9</span>/19<span class=o>)</span> Installing mpfr3 <span class=o>(</span><span class=m>3</span>.1.5-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>10</span>/19<span class=o>)</span> Installing mpc1 <span class=o>(</span><span class=m>1</span>.0.3-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>11</span>/19<span class=o>)</span> Installing gcc <span class=o>(</span><span class=m>6</span>.3.0-r4<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>12</span>/19<span class=o>)</span> Installing musl-dev <span class=o>(</span><span class=m>1</span>.1.16-r15<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>13</span>/19<span class=o>)</span> Installing libc-dev <span class=o>(</span><span class=m>0</span>.7.1-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>14</span>/19<span class=o>)</span> Installing g++ <span class=o>(</span><span class=m>6</span>.3.0-r4<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>15</span>/19<span class=o>)</span> Installing make <span class=o>(</span><span class=m>4</span>.2.1-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>16</span>/19<span class=o>)</span> Installing fortify-headers <span class=o>(</span><span class=m>0</span>.8-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>17</span>/19<span class=o>)</span> Installing build-base <span class=o>(</span><span class=m>0</span>.5-r0<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>18</span>/19<span class=o>)</span> Upgrading musl-utils <span class=o>(</span><span class=m>1</span>.1.16-r14 -&gt; <span class=m>1</span>.1.16-r15<span class=o>)</span>
    docker: <span class=o>(</span><span class=m>19</span>/19<span class=o>)</span> Installing python2-dev <span class=o>(</span><span class=m>2</span>.7.15-r0<span class=o>)</span>
    docker: Executing busybox-1.26.2-r11.trigger
    docker: OK: <span class=m>274</span> MiB <span class=k>in</span> <span class=m>64</span> packages
    docker: Collecting pip
    docker:   Downloading https://files.pythonhosted.org/packages/d8/f3/413bab4ff08e1fc4828dfc59996d721917df8e8583ea85385d51125dceff/pip-19.0.3-py2.py3-none-any.whl <span class=o>(</span><span class=m>1</span>.4MB<span class=o>)</span>
    docker: Installing collected packages: pip
    docker:   Found existing installation: pip <span class=m>9</span>.0.1
    docker:     Uninstalling pip-9.0.1:
    docker:       Successfully uninstalled pip-9.0.1
    docker: Successfully installed pip-19.0.3
    docker: DEPRECATION: Python <span class=m>2</span>.7 will reach the end of its life on January 1st, <span class=m>2020</span>. Please upgrade your Python as Python <span class=m>2</span>.7 won<span class=s1>&#39;t be maintained after that date. A future version of pip will drop support for Python 2.7.</span>
<span class=s1>    docker: Requirement already satisfied: awscli in /usr/lib/python2.7/site-packages (1.16.106)</span>
<span class=s1>    docker: Requirement already satisfied: s3transfer&lt;0.3.0,&gt;=0.2.0 in /usr/lib/python2.7/site-packages (from awscli) (0.2.0)</span>
<span class=s1>    docker: Requirement already satisfied: docutils&gt;=0.10 in /usr/lib/python2.7/site-packages (from awscli) (0.14)</span>
<span class=s1>    docker: Requirement already satisfied: botocore==1.12.96 in /usr/lib/python2.7/site-packages (from awscli) (1.12.96)</span>
<span class=s1>    docker: Requirement already satisfied: PyYAML&lt;=3.13,&gt;=3.10 in /usr/lib/python2.7/site-packages (from awscli) (3.13)</span>
<span class=s1>    docker: Requirement already satisfied: colorama&lt;=0.3.9,&gt;=0.2.5 in /usr/lib/python2.7/site-packages (from awscli) (0.3.9)</span>
<span class=s1>    docker: Requirement already satisfied: rsa&lt;=3.5.0,&gt;=3.1.2 in /usr/lib/python2.7/site-packages (from awscli) (3.4.2)</span>
<span class=s1>    docker: Requirement already satisfied: futures&lt;4.0.0,&gt;=2.2.0; python_version == &quot;2.6&quot; or python_version == &quot;2.7&quot; in /usr/lib/python2.7/site-packages (from s3transfer&lt;0.3.0,&gt;=0.2.0-&gt;awscli) (3.2.0)</span>
<span class=s1>    docker: Requirement already satisfied: urllib3&lt;1.25,&gt;=1.20; python_version == &quot;2.7&quot; in /usr/lib/python2.7/site-packages (from botocore==1.12.96-&gt;awscli) (1.24.1)</span>
<span class=s1>    docker: Requirement already satisfied: python-dateutil&lt;3.0.0,&gt;=2.1; python_version &gt;= &quot;2.7&quot; in /usr/lib/python2.7/site-packages (from botocore==1.12.96-&gt;awscli) (2.8.0)</span>
<span class=s1>    docker: Requirement already satisfied: jmespath&lt;1.0.0,&gt;=0.7.1 in /usr/lib/python2.7/site-packages (from botocore==1.12.96-&gt;awscli) (0.9.3)</span>
<span class=s1>    docker: Requirement already satisfied: pyasn1&gt;=0.1.3 in /usr/lib/python2.7/site-packages (from rsa&lt;=3.5.0,&gt;=3.1.2-&gt;awscli) (0.4.5)</span>
<span class=s1>    docker: Requirement already satisfied: six&gt;=1.5 in /usr/lib/python2.7/site-packages (from python-dateutil&lt;3.0.0,&gt;=2.1; python_version &gt;= &quot;2.7&quot;-&gt;botocore==1.12.96-&gt;awscli) (1.12.0)</span>
<span class=s1>==&gt; docker: Committing the container</span>
<span class=s1>    docker: Image ID: sha256:8af22b4e91c0e6ebc53e309ac3d803c989e7007c9e6c3f57dadeda0d059006d6</span>
<span class=s1>==&gt; docker: Killing the container: 5fbda610d9117b5a2c20f5da6e77b4cb230114c44fbf79b168a30e32e3bc26f2</span>
<span class=s1>==&gt; docker: Running post-processor: docker-tag</span>
<span class=s1>    docker (docker-tag): Tagging image: sha256:8af22b4e91c0e6ebc53e309ac3d803c989e7007c9e6c3f57dadeda0d059006d6</span>
<span class=s1>    docker (docker-tag): Repository: 123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5</span>
<span class=s1>==&gt; docker: Running post-processor: docker-push</span>
<span class=s1>    docker (docker-push): Fetching ECR credentials...</span>
<span class=s1>    docker (docker-push): Logging in...</span>
<span class=s1>    docker (docker-push): Login Succeeded</span>
<span class=s1>    docker (docker-push): Pushing: 123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5</span>
<span class=s1>    docker (docker-push): The push refers to repository [123456789012.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container]</span>
<span class=s1>    docker (docker-push): 17073917cb42: Preparing</span>
<span class=s1>    docker (docker-push): 96287b9167c6: Preparing</span>
<span class=s1>    docker (docker-push): 8619e10b942a: Preparing</span>
<span class=s1>    docker (docker-push): e74e4c2ec07f: Preparing</span>
<span class=s1>    docker (docker-push): 780b2a6e852d: Preparing</span>
<span class=s1>    docker (docker-push): e79522dce35e: Preparing</span>
<span class=s1>    docker (docker-push): e79522dce35e: Waiting</span>
<span class=s1>    docker (docker-push): 96287b9167c6: Pushed</span>
<span class=s1>    docker (docker-push): e79522dce35e: Pushed</span>
<span class=s1>    docker (docker-push): 8619e10b942a: Pushed</span>
<span class=s1>    docker (docker-push): 780b2a6e852d: Pushed</span>
<span class=s1>    docker (docker-push): e74e4c2ec07f: Pushed</span>
<span class=s1>    docker (docker-push): 17073917cb42: Pushed</span>
<span class=s1>    docker (docker-push): 5: digest: sha256:5407f913fb6493f6d67079b562bfc570775c4a649eaf1ee58c6151abfea0b139 size: 1582</span>
<span class=s1>    docker (docker-push): Logging out...</span>
<span class=s1>    docker (docker-push): Removing login credentials for 123456789012.dkr.ecr.eu-west-1.amazonaws.com</span>
<span class=s1>Build &#39;</span>docker<span class=err>&#39;</span> finished.

<span class=o>==</span>&gt; Builds finished. The artifacts of successful builds are:
--&gt; docker: Imported Docker image: sha256:8af22b4e91c0e6ebc53e309ac3d803c989e7007c9e6c3f57dadeda0d059006d6
--&gt; docker: Imported Docker image: <span class=m>123456789012</span>.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5
--&gt; docker: Imported Docker image: <span class=m>123456789012</span>.dkr.ecr.eu-west-1.amazonaws.com/aws-codebuild-container:5
</code></pre></div> <p>So that's an example of nearly every key component to build your Dockerfile. All that's required is a tool to host it in.</p> <div class="admonition note the cons"> <p class=admonition-title>Note</p> <ul> <li>Packer build only works with docker images that already have SSH on them.</li> <li>Shell Provisioners - Bash scripts only run if you have Bash installed in your container.</li> <li>Packer Docker builds can't build from 'scratch'.</li> <li>Packer Provisioners use SSH, images like a Base Alpine will fail, so you can only base your containers that have SSH installed.</li> <li>No Layer caching.</li> </ul> </div> </article> </div> </div> </main> <footer class=md-footer> <div class=md-footer-nav> <nav class="md-footer-nav__inner md-grid" aria-label=Footer> <a href=../packer-aws-ami.3/ class="md-footer-nav__link md-footer-nav__link--prev" rel=prev> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12z"/></svg> </div> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Previous </span> Versioning </div> </div> </a> <a href=../docker-hcl2/ class="md-footer-nav__link md-footer-nav__link--next" rel=next> <div class=md-footer-nav__title> <div class=md-ellipsis> <span class=md-footer-nav__direction> Next </span> docker-hcl </div> </div> <div class="md-footer-nav__button md-icon"> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 24 24"><path d="M4 11v2h12l-5.5 5.5 1.42 1.42L19.84 12l-7.92-7.92L10.5 5.5 16 11H4z"/></svg> </div> </a> </nav> </div> <div class="md-footer-meta md-typeset"> <div class="md-footer-meta__inner md-grid"> <div class=md-footer-copyright> <div class=md-footer-copyright__highlight> Copyright &copy; 2019 - 2021 James Woolfenden </div> Made with <a href=https://squidfunk.github.io/mkdocs-material/ target=_blank rel=noopener> Material for MkDocs </a> </div> <div class=md-footer-social> <a href=https://github.com/jameswoolfenden target=_blank rel=noopener title=github.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 480 512"><path d="M186.1 328.7c0 20.9-10.9 55.1-36.7 55.1s-36.7-34.2-36.7-55.1 10.9-55.1 36.7-55.1 36.7 34.2 36.7 55.1zM480 278.2c0 31.9-3.2 65.7-17.5 95-37.9 76.6-142.1 74.8-216.7 74.8-75.8 0-186.2 2.7-225.6-74.8-14.6-29-20.2-63.1-20.2-95 0-41.9 13.9-81.5 41.5-113.6-5.2-15.8-7.7-32.4-7.7-48.8 0-21.5 4.9-32.3 14.6-51.8 45.3 0 74.3 9 108.8 36 29-6.9 58.8-10 88.7-10 27 0 54.2 2.9 80.4 9.2 34-26.7 63-35.2 107.8-35.2 9.8 19.5 14.6 30.3 14.6 51.8 0 16.4-2.6 32.7-7.7 48.2 27.5 32.4 39 72.3 39 114.2zm-64.3 50.5c0-43.9-26.7-82.6-73.5-82.6-18.9 0-37 3.4-56 6-14.9 2.3-29.8 3.2-45.1 3.2-15.2 0-30.1-.9-45.1-3.2-18.7-2.6-37-6-56-6-46.8 0-73.5 38.7-73.5 82.6 0 87.8 80.4 101.3 150.4 101.3h48.2c70.3 0 150.6-13.4 150.6-101.3zm-82.6-55.1c-25.8 0-36.7 34.2-36.7 55.1s10.9 55.1 36.7 55.1 36.7-34.2 36.7-55.1-10.9-55.1-36.7-55.1z"/></svg> </a> <a href=https://twitter.com/JimWoolfenden target=_blank rel=noopener title=twitter.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 512 512"><path d="M459.37 151.716c.325 4.548.325 9.097.325 13.645 0 138.72-105.583 298.558-298.558 298.558-59.452 0-114.68-17.219-161.137-47.106 8.447.974 16.568 1.299 25.34 1.299 49.055 0 94.213-16.568 130.274-44.832-46.132-.975-84.792-31.188-98.112-72.772 6.498.974 12.995 1.624 19.818 1.624 9.421 0 18.843-1.3 27.614-3.573-48.081-9.747-84.143-51.98-84.143-102.985v-1.299c13.969 7.797 30.214 12.67 47.431 13.319-28.264-18.843-46.781-51.005-46.781-87.391 0-19.492 5.197-37.36 14.294-52.954 51.655 63.675 129.3 105.258 216.365 109.807-1.624-7.797-2.599-15.918-2.599-24.04 0-57.828 46.782-104.934 104.934-104.934 30.213 0 57.502 12.67 76.67 33.137 23.715-4.548 46.456-13.32 66.599-25.34-7.798 24.366-24.366 44.833-46.132 57.827 21.117-2.273 41.584-8.122 60.426-16.243-14.292 20.791-32.161 39.308-52.628 54.253z"/></svg> </a> <a href=https://www.linkedin.com/in/jameswoolfenden/ target=_blank rel=noopener title=www.linkedin.com class=md-footer-social__link> <svg xmlns=http://www.w3.org/2000/svg viewbox="0 0 448 512"><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3zM135.4 416H69V202.2h66.5V416zm-33.2-243c-21.3 0-38.5-17.3-38.5-38.5S80.9 96 102.2 96c21.2 0 38.5 17.3 38.5 38.5 0 21.3-17.2 38.5-38.5 38.5zm282.1 243h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9V416z"/></svg> </a> </div> </div> </div> </footer> </div> <script src=../assets/javascripts/vendor.18f0862e.min.js></script> <script src=../assets/javascripts/bundle.994580cf.min.js></script><script id=__lang type=application/json>{"clipboard.copy": "Copy to clipboard", "clipboard.copied": "Copied to clipboard", "search.config.lang": "en", "search.config.pipeline": "trimmer, stopWordFilter", "search.config.separator": "[\\s\\-]+", "search.placeholder": "Search", "search.result.placeholder": "Type to start searching", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.term.missing": "Missing"}</script> <script>
        app = initialize({
          base: "..",
          features: ['navigation.tabs', 'navigation.instant'],
          search: Object.assign({
            worker: "../assets/javascripts/worker/search.9c0e82ba.min.js"
          }, typeof search !== "undefined" && search)
        })
      </script> </body> </html>